{% assign seo_title = page.title | default: site.title %}
{% assign seo_description = page.description | default: page.excerpt | default: site.description | strip_html | normalize_whitespace %}
{% assign seo_image = page.image | default: site.logo | default: "/assets/kafclaw.png" %}

<script>
  (function () {
    try {
      var pref = localStorage.getItem("kafclaw-theme");
      if (pref === "dark" || pref === "light") {
        document.documentElement.setAttribute("data-theme", pref);
      } else {
        document.documentElement.removeAttribute("data-theme");
      }
    } catch (e) {}
  })();
</script>

<link rel="icon" type="image/png" href="{{ seo_image | relative_url }}">
<link rel="apple-touch-icon" href="{{ seo_image | relative_url }}">

<style>
  .theme-switcher {
    display: inline-flex;
    align-items: center;
    gap: 0.2rem;
    padding: 0.15rem;
    border: 1px solid var(--border-color);
    border-radius: 999px;
    background: var(--sidebar-color);
  }

  .theme-switcher button {
    border: 0;
    background: transparent;
    color: var(--body-text-color);
    font-size: 0.72rem;
    line-height: 1;
    border-radius: 999px;
    padding: 0.3rem 0.5rem;
    cursor: pointer;
  }

  .theme-switcher button:hover {
    background: var(--feedback-color);
  }

  .theme-switcher button[aria-pressed="true"] {
    background: var(--btn-primary-color);
    color: #fff;
  }

  .theme-switcher-label {
    display: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    var auxNav = document.querySelector(".aux-nav .aux-nav-list");
    if (!auxNav || document.getElementById("kafclaw-theme-switcher")) return;

    var li = document.createElement("li");
    li.className = "aux-nav-list-item";
    li.id = "kafclaw-theme-switcher";

    var wrap = document.createElement("div");
    wrap.className = "theme-switcher";
    wrap.setAttribute("role", "group");
    wrap.setAttribute("aria-label", "Theme");

    var label = document.createElement("span");
    label.className = "theme-switcher-label";
    label.textContent = "Theme";
    wrap.appendChild(label);

    function makeBtn(value, text) {
      var btn = document.createElement("button");
      btn.type = "button";
      btn.dataset.theme = value;
      btn.textContent = text;
      btn.setAttribute("aria-pressed", "false");
      return btn;
    }

    var btnAuto = makeBtn("auto", "Auto");
    var btnLight = makeBtn("light", "Light");
    var btnDark = makeBtn("dark", "Dark");
    wrap.appendChild(btnAuto);
    wrap.appendChild(btnLight);
    wrap.appendChild(btnDark);

    function currentTheme() {
      try {
        var pref = localStorage.getItem("kafclaw-theme");
        return pref === "light" || pref === "dark" ? pref : "auto";
      } catch (e) {
        return "auto";
      }
    }

    function applyTheme(val) {
      try {
        if (val === "auto") {
          localStorage.removeItem("kafclaw-theme");
          document.documentElement.removeAttribute("data-theme");
        } else {
          localStorage.setItem("kafclaw-theme", val);
          document.documentElement.setAttribute("data-theme", val);
        }
      } catch (e) {}
    }

    function paintActive(val) {
      [btnAuto, btnLight, btnDark].forEach(function (b) {
        b.setAttribute("aria-pressed", b.dataset.theme === val ? "true" : "false");
      });
    }

    [btnAuto, btnLight, btnDark].forEach(function (btn) {
      btn.addEventListener("click", function () {
        var val = btn.dataset.theme;
        applyTheme(val);
        paintActive(val);
      });
    });

    paintActive(currentTheme());
    li.appendChild(wrap);
    auxNav.appendChild(li);
  });
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{% if page.url == '/' %}WebSite{% else %}TechArticle{% endif %}",
  "name": "{{ seo_title | escape }}",
  "headline": "{{ seo_title | escape }}",
  "description": "{{ seo_description | escape }}",
  "url": "{{ page.url | absolute_url }}",
  "inLanguage": "en-US",
  "publisher": {
    "@type": "Organization",
    "name": "Scalytics",
    "url": "https://www.scalytics.io",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ '/assets/kafclaw.png' | absolute_url }}"
    }
  },
  "isPartOf": {
    "@type": "WebSite",
    "name": "{{ site.title | escape }}",
    "url": "{{ '/' | absolute_url }}"
  }
}
</script>
